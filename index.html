<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FluxShift | USDC Cross-Chain Bridge</title>
  <meta name="description" content="Transfira USDC entre blockchains de forma r√°pida e segura">
  <meta name="keywords" content="USDC, bridge, cross-chain, crypto, blockchain, Circle, CCTP">
  <meta property="og:title" content="FluxShift - USDC Bridge">
  <meta property="og:description" content="Transfira USDC entre blockchains de forma r√°pida e segura">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://fluxshift.app">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>‚ö°</text></svg>">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Sora:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
  <style>
    *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }
    
    :root {
      --bg-primary: #030306;
      --bg-secondary: #0a0a10;
      --bg-card: #0d0d14;
      --bg-input: #111118;
      --bg-hover: #16161f;
      --border: #1a1a28;
      --border-active: #2d2d45;
      --text-primary: #ffffff;
      --text-secondary: #8585a0;
      --text-muted: #4a4a60;
      --accent-primary: #00e5ff;
      --accent-secondary: #6366f1;
      --accent-tertiary: #22c55e;
      --error: #ef4444;
      --warning: #f59e0b;
      --success: #22c55e;
      --gradient-main: linear-gradient(135deg, #00e5ff 0%, #6366f1 50%, #22c55e 100%);
      --gradient-accent: linear-gradient(135deg, #00e5ff 0%, #6366f1 100%);
      --shadow-glow: 0 0 100px rgba(0, 229, 255, 0.12);
      --radius-sm: 8px;
      --radius-md: 12px;
      --radius-lg: 16px;
      --radius-xl: 24px;
    }

    html { scroll-behavior: smooth; }
    
    body {
      font-family: 'Sora', -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      min-height: 100vh;
      overflow-x: hidden;
      line-height: 1.5;
    }

    /* ===== BACKGROUND ===== */
    .bg-effects {
      position: fixed;
      inset: 0;
      pointer-events: none;
      z-index: 0;
      overflow: hidden;
    }

    .bg-gradient {
      position: absolute;
      width: 200%;
      height: 200%;
      top: -50%;
      left: -50%;
      background: 
        radial-gradient(ellipse at 15% 15%, rgba(0, 229, 255, 0.07) 0%, transparent 45%),
        radial-gradient(ellipse at 85% 85%, rgba(99, 102, 241, 0.07) 0%, transparent 45%),
        radial-gradient(ellipse at 50% 100%, rgba(34, 197, 94, 0.04) 0%, transparent 35%);
      animation: bgFloat 25s ease-in-out infinite;
    }

    @keyframes bgFloat {
      0%, 100% { transform: translate(0, 0) rotate(0deg) scale(1); }
      33% { transform: translate(1%, -1%) rotate(0.5deg) scale(1.02); }
      66% { transform: translate(-1%, 1%) rotate(-0.5deg) scale(0.98); }
    }

    .bg-grid {
      position: absolute;
      inset: 0;
      background-image: 
        linear-gradient(rgba(255,255,255,0.015) 1px, transparent 1px),
        linear-gradient(90deg, rgba(255,255,255,0.015) 1px, transparent 1px);
      background-size: 80px 80px;
      mask-image: radial-gradient(ellipse at center, black 0%, transparent 75%);
    }

    .particles { position: absolute; inset: 0; }
    .particle {
      position: absolute;
      background: var(--accent-primary);
      border-radius: 50%;
      opacity: 0;
      animation: particleFade 8s ease-in-out infinite;
    }
    @keyframes particleFade {
      0%, 100% { opacity: 0; transform: translateY(0) scale(0.5); }
      50% { opacity: 0.35; transform: translateY(-50px) scale(1); }
    }

    /* ===== LAYOUT ===== */
    .app-container {
      position: relative;
      z-index: 1;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    /* ===== HEADER ===== */
    .header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 100;
      padding: 0.875rem 1.5rem;
      background: rgba(3, 3, 6, 0.88);
      backdrop-filter: blur(24px);
      border-bottom: 1px solid var(--border);
    }

    .header-inner {
      max-width: 1400px;
      margin: 0 auto;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 12px;
      text-decoration: none;
      color: var(--text-primary);
    }

    .logo-icon {
      width: 42px;
      height: 42px;
      background: var(--gradient-main);
      border-radius: var(--radius-md);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.35rem;
      box-shadow: 0 0 30px rgba(0, 229, 255, 0.3);
    }

    .logo-text {
      font-size: 1.35rem;
      font-weight: 700;
      letter-spacing: -0.3px;
    }

    .logo-text span {
      background: var(--gradient-accent);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .header-right {
      display: flex;
      align-items: center;
      gap: 0.875rem;
    }

    .server-status {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 14px;
      background: var(--bg-input);
      border: 1px solid var(--border);
      border-radius: var(--radius-md);
      font-size: 0.8rem;
      color: var(--text-secondary);
    }

    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: var(--text-muted);
      transition: all 0.3s;
    }

    .status-dot.online {
      background: var(--success);
      box-shadow: 0 0 12px var(--success);
      animation: statusPulse 2s ease-in-out infinite;
    }

    .status-dot.offline { background: var(--error); }
    .status-dot.checking { background: var(--warning); animation: statusPulse 1s ease-in-out infinite; }

    @keyframes statusPulse {
      0%, 100% { opacity: 1; transform: scale(1); }
      50% { opacity: 0.6; transform: scale(1.15); }
    }

    .wallet-btn {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px 18px;
      background: var(--bg-input);
      border: 1px solid var(--border);
      border-radius: var(--radius-md);
      color: var(--text-primary);
      font-family: inherit;
      font-size: 0.9rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .wallet-btn:hover {
      border-color: var(--accent-primary);
      background: rgba(0, 229, 255, 0.05);
    }

    .wallet-btn.connected {
      background: rgba(34, 197, 94, 0.08);
      border-color: rgba(34, 197, 94, 0.25);
    }

    .wallet-btn.connected::before {
      content: '';
      width: 9px;
      height: 9px;
      background: var(--success);
      border-radius: 50%;
      animation: statusPulse 2s ease-in-out infinite;
    }

    /* ===== MAIN ===== */
    .main-content {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 7rem 1.25rem 2.5rem;
    }

    /* ===== BRIDGE CARD ===== */
    .bridge-card {
      width: 100%;
      max-width: 460px;
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: var(--radius-xl);
      overflow: hidden;
      box-shadow: 
        0 0 0 1px rgba(255,255,255,0.02),
        0 25px 80px rgba(0,0,0,0.5),
        var(--shadow-glow);
    }

    .card-header {
      padding: 1.35rem 1.5rem;
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: rgba(255,255,255,0.01);
    }

    .card-title {
      display: flex;
      align-items: center;
      gap: 11px;
      font-size: 1.2rem;
      font-weight: 700;
    }

    .usdc-logo { width: 30px; height: 30px; }

    .network-badge {
      padding: 5px 11px;
      background: rgba(245, 158, 11, 0.1);
      border: 1px solid rgba(245, 158, 11, 0.2);
      border-radius: var(--radius-sm);
      font-size: 0.65rem;
      font-weight: 700;
      color: var(--warning);
      text-transform: uppercase;
      letter-spacing: 0.7px;
    }

    .card-body { padding: 1.5rem; }

    /* ===== FORM ===== */
    .form-group { margin-bottom: 1.1rem; }

    .form-label {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
      font-size: 0.75rem;
      font-weight: 600;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .balance-display {
      font-family: 'JetBrains Mono', monospace;
      color: var(--text-primary);
      font-weight: 500;
    }

    .select-wrapper { position: relative; }

    .chain-select {
      width: 100%;
      padding: 0.95rem 1.1rem;
      padding-right: 2.75rem;
      background: var(--bg-input);
      border: 1px solid var(--border);
      border-radius: var(--radius-lg);
      color: var(--text-primary);
      font-family: inherit;
      font-size: 0.95rem;
      font-weight: 500;
      cursor: pointer;
      appearance: none;
      transition: all 0.25s ease;
    }

    .chain-select:hover { border-color: var(--border-active); }
    .chain-select:focus {
      outline: none;
      border-color: var(--accent-primary);
      box-shadow: 0 0 0 3px rgba(0, 229, 255, 0.08);
    }
    .chain-select:disabled { opacity: 0.5; cursor: not-allowed; }

    .select-arrow {
      position: absolute;
      right: 1rem;
      top: 50%;
      transform: translateY(-50%);
      color: var(--text-muted);
      pointer-events: none;
      font-size: 0.75rem;
    }

    /* ===== SWAP ===== */
    .swap-container {
      display: flex;
      justify-content: center;
      margin: -0.35rem 0 0.65rem;
      position: relative;
      z-index: 10;
    }

    .swap-btn {
      width: 44px;
      height: 44px;
      background: var(--bg-primary);
      border: 2px solid var(--border);
      border-radius: var(--radius-md);
      color: var(--text-secondary);
      font-size: 1.1rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .swap-btn:hover {
      border-color: var(--accent-primary);
      color: var(--accent-primary);
      transform: rotate(180deg);
    }
    .swap-btn:disabled { opacity: 0.35; cursor: not-allowed; transform: none; }

    /* ===== AMOUNT ===== */
    .amount-container { position: relative; }

    .amount-input {
      width: 100%;
      padding: 1.1rem;
      padding-right: 125px;
      background: var(--bg-input);
      border: 1px solid var(--border);
      border-radius: var(--radius-lg);
      color: var(--text-primary);
      font-family: 'JetBrains Mono', monospace;
      font-size: 1.4rem;
      font-weight: 600;
      transition: all 0.25s ease;
    }

    .amount-input:focus {
      outline: none;
      border-color: var(--accent-primary);
      box-shadow: 0 0 0 3px rgba(0, 229, 255, 0.08);
    }
    .amount-input::placeholder { color: var(--text-muted); font-weight: 400; }
    .amount-input:disabled { opacity: 0.5; cursor: not-allowed; }

    .amount-actions {
      position: absolute;
      right: 0.875rem;
      top: 50%;
      transform: translateY(-50%);
      display: flex;
      align-items: center;
      gap: 7px;
    }

    .max-btn {
      padding: 5px 9px;
      background: rgba(0, 229, 255, 0.1);
      border: none;
      border-radius: 6px;
      color: var(--accent-primary);
      font-family: inherit;
      font-size: 0.65rem;
      font-weight: 700;
      cursor: pointer;
      text-transform: uppercase;
      letter-spacing: 0.3px;
      transition: background 0.2s;
    }
    .max-btn:hover { background: rgba(0, 229, 255, 0.18); }
    .max-btn:disabled { opacity: 0.35; cursor: not-allowed; }

    .token-badge {
      padding: 7px 11px;
      background: var(--accent-secondary);
      border-radius: 7px;
      font-size: 0.8rem;
      font-weight: 700;
      color: white;
    }

    /* ===== PROGRESS ===== */
    .progress-section {
      padding: 1.25rem;
      background: rgba(0, 229, 255, 0.025);
      border: 1px solid rgba(0, 229, 255, 0.08);
      border-radius: var(--radius-lg);
      margin-bottom: 1.1rem;
      animation: fadeSlideIn 0.35s ease-out;
    }

    @keyframes fadeSlideIn {
      from { opacity: 0; transform: translateY(-8px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .progress-bar {
      height: 5px;
      background: var(--bg-input);
      border-radius: 3px;
      overflow: hidden;
      margin-bottom: 1.25rem;
    }

    .progress-fill {
      height: 100%;
      background: var(--gradient-main);
      border-radius: 3px;
      transition: width 0.5s ease-out;
    }

    .progress-steps { display: flex; justify-content: space-between; }

    .progress-step {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 7px;
    }

    .step-indicator {
      width: 34px;
      height: 34px;
      background: var(--bg-input);
      border: 2px solid var(--border);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.8rem;
      font-weight: 700;
      transition: all 0.3s ease;
    }

    .progress-step.active .step-indicator {
      border-color: var(--accent-primary);
      background: rgba(0, 229, 255, 0.12);
      color: var(--accent-primary);
      animation: stepPulse 1.3s ease-in-out infinite;
    }

    .progress-step.completed .step-indicator {
      background: var(--success);
      border-color: var(--success);
      color: var(--bg-primary);
    }

    @keyframes stepPulse {
      0%, 100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(0, 229, 255, 0.35); }
      50% { transform: scale(1.06); box-shadow: 0 0 0 10px rgba(0, 229, 255, 0); }
    }

    .step-label {
      font-size: 0.68rem;
      font-weight: 600;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.3px;
    }
    .progress-step.active .step-label,
    .progress-step.completed .step-label { color: var(--text-primary); }

    /* ===== SUCCESS ===== */
    .success-section {
      text-align: center;
      padding: 2.25rem 1.25rem;
      animation: fadeSlideIn 0.4s ease-out;
    }

    .success-icon {
      width: 85px;
      height: 85px;
      background: var(--success);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2.6rem;
      margin: 0 auto 1.35rem;
      animation: successPop 0.55s cubic-bezier(0.68, -0.55, 0.265, 1.55);
      box-shadow: 0 0 50px rgba(34, 197, 94, 0.35);
    }

    @keyframes successPop {
      0% { transform: scale(0) rotate(-180deg); }
      60% { transform: scale(1.15) rotate(8deg); }
      100% { transform: scale(1) rotate(0); }
    }

    .success-section h3 {
      font-size: 1.4rem;
      font-weight: 700;
      color: var(--success);
      margin-bottom: 0.45rem;
    }

    .success-section p {
      color: var(--text-secondary);
      font-size: 0.95rem;
      margin-bottom: 1.35rem;
    }

    .tx-links {
      display: flex;
      flex-direction: column;
      gap: 9px;
      margin-bottom: 1.35rem;
    }

    .tx-link {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 7px;
      padding: 11px 18px;
      background: rgba(0, 229, 255, 0.06);
      border: 1px solid rgba(0, 229, 255, 0.12);
      border-radius: var(--radius-md);
      color: var(--accent-primary);
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.8rem;
      text-decoration: none;
      transition: all 0.25s ease;
    }
    .tx-link:hover { background: rgba(0, 229, 255, 0.12); transform: translateY(-2px); }

    /* ===== ERROR ===== */
    .error-message {
      padding: 1rem 1.1rem;
      background: rgba(239, 68, 68, 0.06);
      border: 1px solid rgba(239, 68, 68, 0.15);
      border-radius: var(--radius-md);
      color: var(--error);
      font-size: 0.88rem;
      text-align: center;
      margin-bottom: 1.1rem;
      animation: shake 0.45s ease-out;
    }

    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      20%, 60% { transform: translateX(-5px); }
      40%, 80% { transform: translateX(5px); }
    }

    /* ===== BUTTONS ===== */
    .primary-btn {
      width: 100%;
      padding: 1.15rem;
      background: var(--gradient-main);
      border: none;
      border-radius: var(--radius-lg);
      color: var(--bg-primary);
      font-family: inherit;
      font-size: 1.05rem;
      font-weight: 700;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      transition: all 0.3s ease;
    }

    .primary-btn:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 12px 45px rgba(0, 229, 255, 0.28);
    }
    .primary-btn:active:not(:disabled) { transform: translateY(0); }
    .primary-btn:disabled { opacity: 0.45; cursor: not-allowed; transform: none; }

    .secondary-btn {
      width: 100%;
      padding: 1.15rem;
      background: var(--bg-input);
      border: 2px solid var(--border);
      border-radius: var(--radius-lg);
      color: var(--text-primary);
      font-family: inherit;
      font-size: 1.05rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.25s ease;
    }
    .secondary-btn:hover { border-color: var(--accent-primary); }

    .spinner {
      width: 20px;
      height: 20px;
      border: 3px solid rgba(3, 3, 6, 0.2);
      border-top-color: var(--bg-primary);
      border-radius: 50%;
      animation: spin 0.75s linear infinite;
    }
    @keyframes spin { to { transform: rotate(360deg); } }

    /* ===== CONNECT ===== */
    .connect-prompt {
      text-align: center;
      padding: 2.75rem 1.25rem;
    }

    .connect-icon {
      font-size: 4.25rem;
      margin-bottom: 1.1rem;
      animation: floatBounce 3.5s ease-in-out infinite;
    }
    @keyframes floatBounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-14px); }
    }

    .connect-prompt h3 {
      font-size: 1.3rem;
      font-weight: 700;
      margin-bottom: 0.65rem;
    }

    .connect-prompt p {
      color: var(--text-secondary);
      font-size: 0.95rem;
      line-height: 1.55;
      margin-bottom: 1.75rem;
    }

    /* ===== FOOTER ===== */
    .card-footer {
      padding: 0.95rem 1.5rem;
      border-top: 1px solid var(--border);
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.75rem;
      color: var(--text-muted);
      background: rgba(0, 0, 0, 0.25);
    }

    .card-footer a {
      color: var(--accent-primary);
      text-decoration: none;
      font-weight: 500;
    }
    .card-footer a:hover { text-decoration: underline; }

    /* ===== RESPONSIVE ===== */
    @media (max-width: 600px) {
      .header { padding: 0.75rem 1rem; }
      .logo-text { display: none; }
      .server-status span:last-child { display: none; }
      .main-content { padding: 5.5rem 1rem 2rem; }
      .bridge-card { border-radius: 20px; }
      .card-body { padding: 1.25rem; }
      .amount-input { font-size: 1.2rem; padding-right: 110px; }
    }
  </style>
</head>
<body>
  <!-- Background -->
  <div class="bg-effects">
    <div class="bg-gradient"></div>
    <div class="bg-grid"></div>
    <div class="particles" id="particles"></div>
  </div>

  <div class="app-container">
    <!-- Header -->
    <header class="header">
      <div class="header-inner">
        <a href="/" class="logo">
          <div class="logo-icon">‚ö°</div>
          <div class="logo-text">Flux<span>Shift</span></div>
        </a>
        <div class="header-right">
          <div class="server-status">
            <div class="status-dot" id="statusDot"></div>
            <span id="statusText">Conectando...</span>
          </div>
          <button class="wallet-btn" id="walletBtn">Conectar</button>
        </div>
      </div>
    </header>

    <!-- Main -->
    <main class="main-content">
      <div class="bridge-card">
        <div class="card-header">
          <div class="card-title">
            <svg class="usdc-logo" viewBox="0 0 32 32" fill="none">
              <circle cx="16" cy="16" r="16" fill="#2775CA"/>
              <path d="M20.5 18.5c0-2.1-1.3-2.8-3.8-3.1-1.8-.3-2.2-.7-2.2-1.5 0-.8.6-1.3 1.8-1.3 1.1 0 1.7.4 2 1.2h2c-.3-1.7-1.5-2.7-3.2-3v-1.5h-1.8v1.5c-1.8.3-3 1.5-3 3.2 0 2 1.2 2.8 3.7 3.1 1.9.3 2.3.8 2.3 1.6 0 .9-.7 1.5-2 1.5-1.4 0-2-.6-2.3-1.5h-2c.3 1.8 1.5 2.9 3.5 3.2v1.5h1.8V21c1.9-.3 3.2-1.5 3.2-3.5z" fill="white"/>
            </svg>
            Bridge USDC
          </div>
          <span class="network-badge">Testnet</span>
        </div>
        <div class="card-body" id="cardBody"></div>
        <div class="card-footer">
          <span>Powered by Circle CCTP</span>
          <a href="https://developers.circle.com/bridge-kit" target="_blank" rel="noopener">Docs ‚Üó</a>
        </div>
      </div>
    </main>
  </div>

  <script>
    // =============================================
    // ‚ö†Ô∏è CONFIGURA√á√ÉO IMPORTANTE
    // =============================================
    // Altere esta URL para o seu backend no Render
    // Exemplo: https://fluxshift-api.onrender.com
    
    const API_URL = "https://fluxshift-api.onrender.com";
    
    // =============================================
    // CHAINS SUPORTADAS
    // =============================================
    const CHAINS = {
      "base-sepolia": { name: "Base Sepolia", icon: "üîµ", chainId: "0x14a34", usdc: "0x036CbD53842c5426634e7929541eC2318f3dCF7e", explorer: "https://sepolia.basescan.org" },
      "ethereum-sepolia": { name: "Ethereum Sepolia", icon: "‚ü†", chainId: "0xaa36a7", usdc: "0x1c7D4B196Cb0C7B01d743Fbc6116a902379C7238", explorer: "https://sepolia.etherscan.io" },
      "arbitrum-sepolia": { name: "Arbitrum Sepolia", icon: "üî∑", chainId: "0x66eee", usdc: "0x75faf114eafb1BDbe2F0316DF893fd58CE46AA4d", explorer: "https://sepolia.arbiscan.io" },
      "optimism-sepolia": { name: "Optimism Sepolia", icon: "üî¥", chainId: "0xaa37dc", usdc: "0x5fd84259d66Cd46123540766Be93DFE6D43130D7", explorer: "https://sepolia-optimism.etherscan.io" },
      "polygon-amoy": { name: "Polygon Amoy", icon: "‚¨°", chainId: "0x13882", usdc: "0x41E94Eb019C0762f9Bfcf9Fb1E58725BfB0e7582", explorer: "https://amoy.polygonscan.com" },
      "avalanche-fuji": { name: "Avalanche Fuji", icon: "üî∫", chainId: "0xa869", usdc: "0x5425890298aed601595a70AB815c96711a31Bc65", explorer: "https://testnet.snowtrace.io" }
    };

    // =============================================
    // ESTADO
    // =============================================
    let state = {
      wallet: null,
      balance: "0.00",
      fromChain: "base-sepolia",
      toChain: "ethereum-sepolia",
      amount: "",
      status: "idle",
      step: 0,
      error: "",
      txLinks: [],
      serverOnline: false
    };

    // =============================================
    // INICIALIZA√á√ÉO
    // =============================================
    function init() {
      createParticles();
      document.getElementById("walletBtn").onclick = connectWallet;
      checkServer();
      setInterval(checkServer, 15000);
      render();
      setupMetaMaskListeners();
    }

    function createParticles() {
      const container = document.getElementById("particles");
      for (let i = 0; i < 35; i++) {
        const p = document.createElement("div");
        p.className = "particle";
        p.style.left = Math.random() * 100 + "%";
        p.style.top = Math.random() * 100 + "%";
        p.style.animationDelay = Math.random() * 8 + "s";
        p.style.animationDuration = (5 + Math.random() * 5) + "s";
        container.appendChild(p);
      }
    }

    function setupMetaMaskListeners() {
      if (typeof window.ethereum !== "undefined") {
        window.ethereum.on("accountsChanged", accounts => {
          state.wallet = accounts[0] || null;
          state.balance = "0.00";
          fetchBalance().then(render);
          updateWalletBtn();
        });
        window.ethereum.on("chainChanged", () => fetchBalance().then(render));
      }
    }

    // =============================================
    // SERVIDOR
    // =============================================
    async function checkServer() {
      const dot = document.getElementById("statusDot");
      const text = document.getElementById("statusText");
      
      dot.className = "status-dot checking";
      text.textContent = "Verificando...";

      try {
        const res = await fetch(API_URL + "/api/status", { 
          method: "GET",
          headers: { "Accept": "application/json" }
        });
        
        if (res.ok) {
          const data = await res.json();
          state.serverOnline = data.status === "online";
          dot.className = "status-dot online";
          text.textContent = "Online";
        } else {
          throw new Error("Status n√£o OK");
        }
      } catch (e) {
        state.serverOnline = false;
        dot.className = "status-dot offline";
        text.textContent = "Offline";
      }
    }

    // =============================================
    // CARTEIRA
    // =============================================
    async function connectWallet() {
      if (typeof window.ethereum === "undefined") {
        alert("MetaMask n√£o encontrado!\n\nInstale em: https://metamask.io");
        return;
      }
      try {
        const accounts = await window.ethereum.request({ method: "eth_requestAccounts" });
        state.wallet = accounts[0];
        await fetchBalance();
        updateWalletBtn();
        render();
      } catch (e) {
        console.error("Erro conectando:", e);
      }
    }

    function updateWalletBtn() {
      const btn = document.getElementById("walletBtn");
      if (state.wallet) {
        btn.className = "wallet-btn connected";
        btn.textContent = state.wallet.slice(0,6) + "..." + state.wallet.slice(-4);
      } else {
        btn.className = "wallet-btn";
        btn.textContent = "Conectar";
      }
    }

    async function fetchBalance() {
      if (!state.wallet) return;
      const chain = CHAINS[state.fromChain];
      if (!chain) return;
      try {
        const data = "0x70a08231000000000000000000000000" + state.wallet.slice(2);
        const result = await window.ethereum.request({
          method: "eth_call",
          params: [{ to: chain.usdc, data }, "latest"]
        });
        state.balance = (parseInt(result, 16) / 1e6).toFixed(2);
      } catch { state.balance = "0.00"; }
    }

    // =============================================
    // BRIDGE
    // =============================================
    function swapChains() {
      [state.fromChain, state.toChain] = [state.toChain, state.fromChain];
      fetchBalance().then(render);
    }

    function useMax() {
      state.amount = state.balance;
      render();
    }

    async function executeBridge() {
      if (!state.serverOnline) {
        state.error = "Servidor offline. Tente novamente em alguns instantes.";
        render();
        return;
      }
      if (!state.amount || parseFloat(state.amount) <= 0) {
        state.error = "Digite uma quantidade v√°lida";
        render();
        return;
      }
      if (parseFloat(state.amount) > parseFloat(state.balance)) {
        state.error = "Saldo insuficiente";
        render();
        return;
      }

      state.status = "processing";
      state.step = 1;
      state.error = "";
      state.txLinks = [];
      render();

      // Simular progresso enquanto aguarda
      const progressInterval = setInterval(() => {
        if (state.status === "processing" && state.step < 3) {
          state.step++;
          render();
        }
      }, 4000);

      try {
        const response = await fetch(API_URL + "/api/bridge", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            fromChain: state.fromChain,
            toChain: state.toChain,
            amount: state.amount
          })
        });

        const data = await response.json();
        clearInterval(progressInterval);

        if (data.success) {
          state.status = "success";
          state.step = 3;
          state.txLinks = (data.steps || [])
            .filter(s => s.explorerUrl)
            .map(s => ({ name: s.name, url: s.explorerUrl }));
        } else {
          throw new Error(data.error || "Erro na transfer√™ncia");
        }
      } catch (e) {
        clearInterval(progressInterval);
        state.status = "error";
        state.error = e.message || "Erro ao processar transfer√™ncia";
      }
      render();
    }

    function resetBridge() {
      state.status = "idle";
      state.step = 0;
      state.amount = "";
      state.error = "";
      state.txLinks = [];
      fetchBalance().then(render);
    }

    // =============================================
    // RENDER
    // =============================================
    function render() {
      const container = document.getElementById("cardBody");
      const fromChain = CHAINS[state.fromChain];
      const toChain = CHAINS[state.toChain];

      // N√£o conectado
      if (!state.wallet) {
        container.innerHTML = `
          <div class="connect-prompt">
            <div class="connect-icon">üëõ</div>
            <h3>Conecte sua Carteira</h3>
            <p>Conecte sua MetaMask para transferir USDC entre blockchains de forma r√°pida e segura.</p>
            <button class="primary-btn" onclick="connectWallet()">Conectar MetaMask</button>
          </div>
        `;
        return;
      }

      // Sucesso
      if (state.status === "success") {
        const linksHtml = state.txLinks.length > 0
          ? state.txLinks.map(tx => `<a class="tx-link" href="${tx.url}" target="_blank" rel="noopener">${tx.name} ‚Üí Ver no Explorer ‚Üó</a>`).join("")
          : '<span style="color:var(--text-muted);font-size:0.9rem">Transa√ß√µes processadas com sucesso</span>';

        container.innerHTML = `
          <div class="success-section">
            <div class="success-icon">‚úì</div>
            <h3>Transfer√™ncia Conclu√≠da!</h3>
            <p>${state.amount} USDC de ${fromChain.name} para ${toChain.name}</p>
            <div class="tx-links">${linksHtml}</div>
            <button class="secondary-btn" onclick="resetBridge()">Nova Transfer√™ncia</button>
          </div>
        `;
        return;
      }

      // Formul√°rio
      const chainOptions = Object.entries(CHAINS).map(([id, c]) => 
        `<option value="${id}">${c.icon} ${c.name}</option>`
      ).join("");

      const isProcessing = state.status === "processing";
      const canBridge = state.amount && parseFloat(state.amount) > 0 && parseFloat(state.amount) <= parseFloat(state.balance) && state.serverOnline;

      let progressHtml = "";
      if (isProcessing) {
        const steps = ["Aprovar", "Burn", "Mint"];
        progressHtml = `
          <div class="progress-section">
            <div class="progress-bar">
              <div class="progress-fill" style="width: ${(state.step / 3) * 100}%"></div>
            </div>
            <div class="progress-steps">
              ${steps.map((name, i) => {
                const stepNum = i + 1;
                const isCompleted = state.step > stepNum;
                const isActive = state.step === stepNum;
                return `
                  <div class="progress-step ${isCompleted ? 'completed' : ''} ${isActive ? 'active' : ''}">
                    <div class="step-indicator">${isCompleted ? '‚úì' : stepNum}</div>
                    <span class="step-label">${name}</span>
                  </div>
                `;
              }).join("")}
            </div>
          </div>
        `;
      }

      container.innerHTML = `
        <div class="form-group">
          <label class="form-label">De (Origem)</label>
          <div class="select-wrapper">
            <select class="chain-select" id="fromChain" ${isProcessing ? 'disabled' : ''} onchange="state.fromChain = this.value; fetchBalance().then(render);">
              ${chainOptions}
            </select>
            <span class="select-arrow">‚ñº</span>
          </div>
        </div>

        <div class="swap-container">
          <button class="swap-btn" onclick="swapChains()" ${isProcessing ? 'disabled' : ''}>‚áÖ</button>
        </div>

        <div class="form-group">
          <label class="form-label">Para (Destino)</label>
          <div class="select-wrapper">
            <select class="chain-select" id="toChain" ${isProcessing ? 'disabled' : ''} onchange="state.toChain = this.value; render();">
              ${chainOptions}
            </select>
            <span class="select-arrow">‚ñº</span>
          </div>
        </div>

        <div class="form-group">
          <label class="form-label">
            <span>Quantidade</span>
            <span class="balance-display">Saldo: ${state.balance} USDC</span>
          </label>
          <div class="amount-container">
            <input type="number" class="amount-input" placeholder="0.00" value="${state.amount}" 
                   oninput="state.amount = this.value" ${isProcessing ? 'disabled' : ''}>
            <div class="amount-actions">
              <button class="max-btn" onclick="useMax()" ${isProcessing ? 'disabled' : ''}>MAX</button>
              <span class="token-badge">USDC</span>
            </div>
          </div>
        </div>

        ${progressHtml}
        ${state.error ? `<div class="error-message">${state.error}</div>` : ''}

        <button class="primary-btn" onclick="executeBridge()" ${isProcessing || !canBridge ? 'disabled' : ''}>
          ${isProcessing ? '<span class="spinner"></span>Processando...' : 'Bridge USDC'}
        </button>
      `;

      // Setar valores dos selects
      document.getElementById("fromChain").value = state.fromChain;
      document.getElementById("toChain").value = state.toChain;
    }

    // Iniciar
    init();
  </script>
</body>
</html>
